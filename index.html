<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>השוואת תרשימים</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
      direction: rtl;
    }
    #charts-container {
      display: flex;
      flex-direction: row-reverse;
      flex-wrap: nowrap;
      overflow-x: auto;
      gap: 20px;
      padding: 20px;
    }
    .chart-box {
      flex: 0 0 360px;
      background: white;
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    canvas {
      width: 100% !important;
      height: 300px !important;
    }
    .leader-label {
      margin-top: 10px;
      font-weight: bold;
      color: #006400;
    }
  </style>
</head>
<body>
  <div id="charts-container"></div>

  <script>
    // נתונים לדוגמה
    const chartsData = [
      {
        title: 'שלב 1',
        data: [
          { name: 'קבוצה א', judges: 80, votes: 120 },
          { name: 'קבוצה ב', judges: 70, votes: 110 }
        ]
      },
      {
        title: 'שלב 2',
        data: [
          { name: 'קבוצה ג', judges: 60, votes: 130 },
          { name: 'קבוצה ד', judges: 95, votes: 90 }
        ]
      },
      {
        title: 'שלב 3',
        data: [
          { name: 'קבוצה ה', judges: 85, votes: 115 },
          { name: 'קבוצה ו', judges: 90, votes: 100 }
        ]
      }
    ];

    // פונקציה לחישוב סכום נקודות
    function getTotal(item) {
      return item.votes + item.judges;
    }

    // מיין לפי הקבוצה עם סך נקודות הגבוה ביותר בתרשים
    chartsData.sort((a, b) => {
      const maxA = Math.max(...a.data.map(getTotal));
      const maxB = Math.max(...b.data.map(getTotal));
      return maxB - maxA;
    });

    const container = document.getElementById("charts-container");

    chartsData.forEach(({ title, data }, index) => {
      const chartBox = document.createElement("div");
      chartBox.className = "chart-box";

      const canvas = document.createElement("canvas");
      canvas.id = `chart-${index}`;
      chartBox.appendChild(canvas);

      // מציאת הקבוצה המובילה
      const leader = data.reduce((prev, curr) =>
        getTotal(curr) > getTotal(prev) ? curr : prev
      );

      const leaderLabel = document.createElement("div");
      leaderLabel.className = "leader-label";
      leaderLabel.innerText = `🏆 הקבוצה המובילה: ${leader.name}`;
      chartBox.appendChild(leaderLabel);

      container.appendChild(chartBox);

      new Chart(canvas.getContext("2d"), {
        type: "bar",
        data: {
          labels: data.map((item) => item.name),
          datasets: [
            {
              label: "שופטים",
              data: data.map((item) => item.judges),
              backgroundColor: "rgba(54, 162, 235, 0.7)"
            },
            {
              label: "קהל",
              data: data.map((item) => item.votes),
              backgroundColor: "rgba(255, 99, 132, 0.7)"
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            title: {
              display: true,
              text: title,
              font: { size: 18 }
            },
            legend: {
              position: "bottom",
              labels: {
                font: { size: 12 }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    });
  </script>
</body>
</html>
