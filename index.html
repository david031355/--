<!DOCTYPE html>
<html lang="he">
<head>
 <meta charset="UTF-8">
 <title>住 拽 砖驻 拽</title>
 <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
 <style>
  body {
   font-family: Arial, sans-serif;
   direction: rtl;
   padding: 20px;
   background-color: #f4f4f4;
  }
  .controls {
   margin-bottom: 20px;
   text-align: center;
  }
  #charts-container {
   display: flex;
   flex-wrap: nowrap; /* 砖: 砖专 转 转 砖专 转 */
   overflow-x: auto; /* 驻砖专  驻拽转   拽 */
   gap: 20px;
   padding-bottom: 10px; /* 驻 拽   转专 */
  }
  .chart-box {
   flex: 1 1 300px; /* 砖转 :  ,  转抓, 住住 300px */
   min-width: 280px; /* 专  砖转专砖  转抓  */
   background: white;
   border-radius: 12px;
   padding: 15px;
   box-shadow: 0 0 10px rgba(0,0,0,0.1);
   height: 70vh; /* 砖专 注  住  住 */
   box-sizing: border-box;
  }

  @media (max-width: 1200px) {
   .chart-box {
    height: 60vh;
   }
  }

  @media (max-width: 800px) {
   .chart-box {
    height: 50vh;
   }
  }
  button {
   font-size: 16px;
   padding: 10px 20px;
   border: none;
   border-radius: 8px;
   margin: 0 10px;
   transition: background-color 0.3s;
   background-color: #007bff;
   color: white;
   cursor: pointer;
  }

  button:hover {
   background-color: #0056b3;
  }
  canvas {
   height: 400px !important; /*  拽注 转专砖 驻 */
  }
  .leader {
   border: 3px solid #ff0000;
   box-shadow: 0 0 20px rgba(255, 0, 0, 0.4);
  }
 </style>
</head>
<body>
  <h1 style="text-align:center; margin-top: 20px; font-size: 28px; font-family: Arial;">住 拽 砖驻 拽</h1>

<div class="controls">
 <button onclick="fetchGoogleSheetData()"> 专注 转  </button>
</div>

<div id="charts-container"></div>

<script>
// 转转 -URL 砖   砖驻专住 -CSV
const GOOGLE_SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSTToy2f936VEdbQMk3zM9drEvaUeaBajHFsAn1BxMID1j43j8l5T8wwZ-UN5HyfboSAYz4K5UAxCxs/pub?output=csv';

let parsedData = null;

function fetchGoogleSheetData() {
 Papa.parse(GOOGLE_SHEET_CSV_URL, {
  download: true,
  header: true,
  skipEmptyLines: true,
  complete: function(results) {
   parsedData = results.data;
   console.log("转 砖注  :", parsedData);
   if (parsedData && parsedData.length > 0) {
    drawCharts(parsedData);
   } else {
    alert(" 爪 注 转  ,  砖 专拽.  砖拽砖专 转拽  驻专住 -CSV  转.");
   }
  },
  error: function(err, file) {
   console.error("砖 注转 转:", err, file);
   alert("专注 砖 注转 转  .  拽 转 拽住转 驻转 驻专 住驻.");
  }
 });
}

function drawCharts(data) {
 const container = document.getElementById('charts-container');
 container.innerHTML = '';

 let maxVal = 0;
 data.forEach(row => {
  const val1 = parseFloat(row.Value_1) || 0;
  const val2 = parseFloat(row.Value_2) || 0;
  const sum = val1 + val2;
  maxVal = Math.max(maxVal, val1, val2, sum);
 });
 const scaleMax = Math.ceil(maxVal * 1.1);

 data.forEach((row, index) => {
  if (!row.Chart_Title || !row.Label_1 || !row.Label_2 || !row.Value_1 || !row.Value_2) {
   console.warn(`砖专 ${index + 2} ( 转专转) 住专 转 转:`, row);
   return;
  }

  const title = row.Chart_Title || `转专砖 ${index + 1}`;
  const label1 = row.Label_1 || '拽';
  const label2 = row.Label_2 || '砖驻';
  const val1 = parseFloat(row.Value_1) || 0;
  const val2 = parseFloat(row.Value_2) || 0;
  const total = val1 + val2;

  const canvas = document.createElement('canvas');
  const chartBox = document.createElement('div');
  chartBox.className = 'chart-box';
  chartBox.appendChild(canvas);
  container.appendChild(chartBox);

  new Chart(canvas.getContext('2d'), {
   type: 'bar',
   data: {
    labels: [label1, label2, '住"'],
    datasets: [{
     label: title,
     data: [val1, val2, total],
     backgroundColor: ['#42a5f5', '#66bb6a', '#ffa726']
    }]
   },
   options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
     y: {
      suggestedMax: scaleMax,
      beginAtZero: true
     }
    },
    plugins: {
     legend: { display: false },
     title: {
      display: true,
      text: title,
      font: { size: 18 }
     }
    }
   }
  });
 });
}

// 拽专 专砖转 注转 转 砖祝 注
document.addEventListener('DOMContentLoaded', fetchGoogleSheetData);
</script>

</body>
</html>
